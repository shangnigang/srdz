# 尚荣定制管理系统

## 项目介绍
尚荣定制管理系统是一款专为服装定制店铺打造的综合管理解决方案，提供订单管理、成本控制、数据分析等全方位功能，帮助服装定制业务提高运营效率和管理水平。系统采用前端技术构建，具有良好的用户界面和交互体验，可满足中小型服装定制企业的日常管理需求。

## 系统架构
- **前端框架**：HTML5、CSS3、JavaScript、Bootstrap 5
- **UI组件**：FontAwesome 图标、自定义组件
- **数据可视化**：Chart.js、ECharts
- **数据存储**：本地存储(LocalStorage)与服务器API双模式支持
- **后端支持**：基于Express.js的RESTful API服务
- **会话管理**：基于Token的身份验证与授权
- **权限控制**：集中式权限管理，基于角色的访问控制

## 功能模块

### 用户管理与身份验证
- 用户登录与认证（支持本地存储模式和服务器模式）
- 用户权限控制（管理员、普通用户角色划分）
- 个人资料管理
- 密码修改与账户安全

### 订单管理
- 订单创建与编辑
- 订单状态跟踪（待处理、生产中、已完成、已交付）
- 订单详情查看与打印
- 多格式订单导出（Excel、PDF）
- 订单图片上传与预览
- 订单统计与分析
- 批量操作功能

### 成本控制
- 运营成本录入与管理
- 生产成本核算与分析
- 广告投放成本跟踪
- 成本统计与报表生成
- 成本趋势分析与可视化

### 薪资管理
- 员工薪资录入与计算
- 薪资数据统计与分析
- 薪资报表生成
- 历史薪资记录查询

### 数据分析
- 销售数据实时统计
- 订单趋势图表分析
- 业绩可视化展示
- 经营状况综合分析
- 数据导出与报表生成

### 系统设置与指南
- 新用户使用指南
- 功能操作说明
- 系统参数配置
- 数据备份与恢复

## 文件结构

### 主页面文件
- `index.html` - 系统首页/仪表盘
- `login.html` - 用户登录页面
- `order.html` - 订单管理主页面
- `order-detail.html` - 订单详情页面
- `cost.html` - 成本管理页面
- `salary.html` - 薪资管理页面
- `analysis.html` - 数据分析页面
- `data-management.html` - 数据管理页面
- `profile.html` - 个人资料页面
- `guide.html` - 系统使用指南

### 模板和共享组件
- `header-template.html` - 通用头部模板
- `page-skeleton.html` - 页面骨架模板
- `page-template.js` - 页面初始化脚本

### 样式文件
- `styles.css` - 全局通用样式
- `dashboard.css` - 仪表盘特定样式
- `user.css` - 用户管理页面样式

### 核心脚本文件
- `permissions.js` - 统一权限管理模块
- `common.js` - 核心通用功能库，包含数据处理、工具函数和系统修复
- `order.js` - 订单管理核心功能
- `cost.js` - 成本管理功能
- `salary.js` - 薪资管理功能
- `analysis.js` - 数据分析功能
- `data.js` - 数据处理通用功能
- `dashboard.js` - 仪表盘功能
- `auto-init.js` - 自动初始化本地用户数据和令牌

### 辅助功能脚本
- `order-export.js` - 订单导出功能
- `order-statistics.js` - 订单统计功能
- `order-photo-preview.js` - 订单图片预览
- `photo-upload.js` - 图片上传功能

### 第三方库
- `libs/chart.min.js` - Chart.js图表库
- `libs/echarts.min.js` - ECharts图表库
- `libs/chart-loader.js` - 图表库加载器

### 后端服务（服务器模式）
- `server/app.js` - 服务器入口文件
- `server/routes/` - API路由定义
- `server/controllers/` - API控制器
- `server/middleware/` - 中间件（认证、错误处理等）
- `server/models/` - 数据模型
- `server/config/` - 服务器配置

### 前端服务
- `services/api.js` - API通信基础模块
- `services/auth.service.js` - 认证服务
- `services/order.service.js` - 订单服务
- `services/data-migration.service.js` - 数据迁移服务

## 权限控制系统

系统采用集中式权限管理，基于角色的访问控制(RBAC)模型，确保用户只能访问其被授权的功能。

### 统一权限管理

新的权限系统将所有权限控制逻辑集中在`permissions.js`文件中，主要特点包括：

1. **集中管理**：所有权限检查逻辑集中在一个文件中，避免代码冗余
2. **基于角色的权限映射**：每个角色都有明确定义的权限列表
3. **页面级路由保护**：防止未授权用户通过URL直接访问受限页面
4. **元素级权限控制**：使用`data-permission`属性控制界面元素的可见性
5. **权限状态缓存**：减少重复的权限检查，提高性能

### 用户角色与权限

系统定义了三种主要角色：

1. **管理员(admin)**：拥有系统所有功能的访问权限
2. **销售员(sales)**：可以管理订单，但无法访问成本、薪资和数据管理功能
3. **普通用户(user)**：只能查看订单和基本功能，无法进行敏感操作

### 页面集成

所有页面通过以下方式集成权限系统：

1. 引入`permissions.js`，实现权限控制
2. 引入`page-template.js`，统一页面初始化流程
3. 使用`header-template.html`，提供一致的导航界面
4. 通过`data-permission`属性标记需要权限控制的元素

## 系统优化说明

系统经过优化，集成了统一权限管理系统，并已删除以下冗余文件：

1. `user_data.json` - 不必要的文件，因其数据已在auto-init.js中定义
2. `fix-dashboard.html` - 修复工具，其功能已集成到主系统
3. `fix-sales1-permissions.js` - 临时修复脚本，其功能已整合到权限系统
4. `debug-permissions.js` - 开发调试工具，生产环境不需要
5. `data-management-fix.js` - 临时修复脚本，其功能已整合到权限系统
6. `admin-fix.js` - 管理员权限修复脚本，其功能已整合到权限系统中
7. `admin-override.js` - 管理员权限重写脚本，其功能已整合到权限系统
8. `user.html` - 用户管理页面，此功能已整合到数据管理页面的用户管理模块中
9. `user.js` - 用户管理脚本，其功能已整合到数据管理页面和profile.html中

以下文件之前已经整合并删除：
1. `style.css` - 已将其功能合并到 `styles.css` 中
2. `permission-fix.js` - 已将其功能整合到 `permissions.js` 中
3. `dashboard-fix.js` - 已将其功能合并到 `common.js` 中
4. `data-permissions-fix.js` - 已将其功能整合到 `permissions.js` 中
5. `fix_modal.js` - 已将其功能合并到 `common.js` 中
6. `user-permissions.js` - 已将其功能整合到 `permissions.js` 中

这些优化措施不仅减少了系统中的冗余代码和重复文件，还提高了系统的维护性、安全性和加载性能。新的统一权限控制系统提供了更加可靠和一致的用户访问控制。

## 数据存储模式

系统支持两种数据存储模式：

### 本地存储模式
- 使用浏览器的LocalStorage存储所有数据
- 无需服务器，可离线使用
- 适合单机部署或小规模使用场景
- 在登录页面可切换到此模式

### 服务器API模式
- 通过RESTful API与后端服务器通信
- 支持多用户同时访问与数据共享
- 提供更高级的数据安全性和一致性
- 需要部署server目录下的Node.js服务

## 使用说明

### 系统部署
1. 将所有文件部署到Web服务器根目录
2. 如需使用服务器模式，需额外配置并启动Node.js服务：
   ```
   cd server
   npm install
   npm start
   ```

### 快速入门
1. 打开`login.html`进入登录页面
2. 使用默认管理员账号登录：
   - 用户名：admin
   - 密码：admin123
3. 成功登录后进入系统首页
4. 通过左侧导航菜单访问各功能模块

### 主要功能入口
- 订单管理：创建、查看和管理所有客户订单
- 成本管理：记录和分析各类成本支出
- 工资录入：管理员工薪资信息
- 经营分析：查看经营数据和趋势图表
- 数据管理：导入导出和备份恢复数据

## 安全与权限

系统实现了基于角色的访问控制（RBAC）：
- **管理员**：拥有系统全部功能的访问权限
- **销售员**：可以管理订单，但无法访问成本和薪资功能
- **普通用户**：仅可访问基本功能，无法操作敏感数据

用户权限控制由统一的`permissions.js`实现，提供完整的权限检查和页面保护功能。

### 认证与会话安全

系统使用强化的认证和会话安全机制：
- **统一认证检查**：所有页面都通过`auth-check.js`强制进行身份验证，无法绕过登录直接访问
- **会话过期控制**：用户Token具有明确的过期时间，支持"记住我"（7天）和标准会话（12小时）
- **令牌完整性验证**：在多个层面验证认证令牌的有效性，防止伪造
- **会话状态监测**：实时检查用户会话状态，确保用户权限始终在有效范围内
- **安全降级处理**：当用户会话过期或无效时，自动清除本地凭证并重定向至登录页

该安全机制确保了系统的每个页面都受到适当的保护，未经授权的用户无法通过直接访问URL的方式绕过登录流程，大大增强了系统的整体安全性。

## 开发与维护
- 项目采用模块化开发，各功能模块相对独立
- CSS样式文件分为公共样式与模块专用样式
- JavaScript文件按功能模块划分，便于维护
- 所有页面均支持响应式设计，适配PC和移动设备

 